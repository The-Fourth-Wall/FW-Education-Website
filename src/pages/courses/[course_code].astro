---
import Layout from "../../layouts/Layout.astro";
import {parse_curriculum_file_content} from "../../utils/parser";
import type {Course} from "../../models/types";
import fs from "node:fs";
import path from "node:path";
import Button from "../../atoms/Button.astro";
import CourseDetailCard from "../../components/CourseDetailCard.astro";

export type Props = {
  course: Course;
};

export async function getStaticPaths() {
  const curriculum_file_path = path.resolve(process.cwd(), "curriculum.md");
  let courses_data: Course[] = [];
  try {
    const file_content = fs.readFileSync(curriculum_file_path, "utf-8");
    courses_data = parse_curriculum_file_content(file_content);
  } catch (e: unknown) {
    console.error(
      "Error fetching courses for static paths:",
      e instanceof Error ? e.message : String(e),
    );
    return [];
  }

  return courses_data.map((course_item: Course) => ({
    params: {course_code: course_item.course_code.toLowerCase()},
    props: {course: course_item},
  }));
}

const {course} = Astro.props;

const difficulty_border_colors: {[key: string]: string} = {
  Fundamental: "border-green-700",
  Beginner: "border-blue-700",
  Intermediate: "border-yellow-600",
  Advanced: "border-red-700",
  Unknown: "border-gray-800",
};
const border_color_class =
  difficulty_border_colors[course.difficulty] ||
  difficulty_border_colors["Unknown"];

const difficulty_text_colors: {[key: string]: string} = {
  Fundamental: "text-green-400",
  Beginner: "text-blue-400",
  Intermediate: "text-yellow-400",
  Advanced: "text-red-400",
  Unknown: "text-gray-400",
};
const text_color_class =
  difficulty_text_colors[course.difficulty] ||
  difficulty_text_colors["Unknown"];

const difficulty_badge_styles: Record<string, string> = {
  Fundamental: "bg-green-800 text-green-200",
  Beginner: "bg-blue-800 text-blue-200",
  Intermediate: "bg-yellow-700 text-yellow-200",
  Advanced: "bg-red-800 text-red-200",
  Unknown: "bg-gray-800 text-gray-300",
};
const badge_style_class =
  difficulty_badge_styles[course.difficulty] || difficulty_badge_styles.Unknown;
---

<Layout title={`${course.course_code}: ${course.course_name} Details`}>
  <main class="container mx-auto px-4 py-8 text-white min-h-screen">
    <div class="mb-6">
      <Button
        href="/"
        text="Â« Return to Courses"
        variant="link"
        extra_classes="text-sky-400 hover:text-sky-300 transition-colors duration-150 text-sm"
      />
    </div>
    <CourseDetailCard
      course={course}
      border_color_class={border_color_class}
      text_color_class={text_color_class}
      badge_style_class={badge_style_class}
    />
  </main>
</Layout>
